{% extends "base.html" %}

{% block title %}AI Feedback - AAFS AI{% endblock %}

{% block extra_css %}
<style>
    .feedback-page {
        max-width: 1400px;
        margin: 0 auto;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        flex-wrap: wrap;
        gap: 16px;
    }

    .page-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--text-main);
        margin: 0;
    }

    .filter-tabs {
        display: flex;
        gap: 8px;
    }

    .filter-tab {
        padding: 8px 16px;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        color: var(--text-secondary);
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .filter-tab.active {
        background: var(--accent);
        color: var(--white);
        border-color: var(--accent);
    }

    .feedback-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .feedback-card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 24px;
        border: 1px solid var(--border-color);
        transition: all 0.2s ease;
    }

    .feedback-card:hover {
        border-color: #6366f1;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
    }

    .feedback-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 16px;
        flex-wrap: wrap;
        gap: 12px;
    }

    .student-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .student-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: #ffffff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        font-weight: 700;
    }

    .student-details h3 {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-main);
        margin: 0 0 4px 0;
    }

    .student-details p {
        font-size: 0.8125rem;
        color: var(--text-secondary);
        margin: 0;
    }

    .submission-meta {
        text-align: right;
    }

    .submission-type {
        display: inline-block;
        padding: 4px 12px;
        background: rgba(99, 102, 241, 0.1);
        color: #6366f1;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .submission-date {
        font-size: 0.8125rem;
        color: var(--text-secondary);
    }

    .feedback-content {
        margin-top: 16px;
    }

    .feedback-text {
        font-size: 0.9375rem;
        color: var(--text-main);
        line-height: 1.6;
        margin: 0 0 16px 0;
    }

    .feedback-scores {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid var(--border-color);
    }

    .score-item {
        display: flex;
        flex-direction: column;
    }

    .score-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-bottom: 4px;
    }

    .score-value {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text-main);
    }

    .feedback-actions {
        display: flex;
        gap: 8px;
        margin-top: 16px;
    }

    .btn-feedback {
        padding: 8px 16px;
        background: var(--accent);
        color: var(--white);
        border: none;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.8125rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .btn-feedback:hover {
        background: var(--accent-hover);
    }

    .btn-feedback.secondary {
        background: transparent;
        color: var(--accent);
        border: 1px solid var(--accent);
    }
</style>
{% endblock %}

{% block content %}
<div class="feedback-page">
    <div class="page-header">
        <h1 class="page-title">AI Feedback</h1>
        <div class="filter-tabs">
            <button class="filter-tab {% if selected_type == 'all' %}active{% endif %}" onclick="applyFilter('all')">All</button>
            <button class="filter-tab {% if selected_type == 'writing' %}active{% endif %}" onclick="applyFilter('writing')">Writing</button>
            <button class="filter-tab {% if selected_type == 'speaking' %}active{% endif %}" onclick="applyFilter('speaking')">Speaking</button>
            <button class="filter-tab {% if selected_type == 'handwritten' %}active{% endif %}" onclick="applyFilter('handwritten')">Handwritten</button>
        </div>
    </div>

    <div class="feedback-list" id="feedbackList">
        {% for submission in submissions %}
        <div class="feedback-card" data-type="{{ submission.submission_type|lower }}">
            <div class="feedback-header">
                <div class="student-info">
                    <div class="student-avatar">{{ submission.student.username[0] | upper }}</div>
                    <div class="student-details">
                        <h3>{{ submission.student.username }}</h3>
                        <p>{{ submission.student.email }}</p>
                    </div>
                </div>
                <div class="submission-meta">
                    <span class="submission-type">{{ submission.submission_type }}</span>
                    <div class="submission-date">{{ submission.created_at.strftime('%b %d, %Y %H:%M') if submission.created_at else 'N/A' }}</div>
                </div>
            </div>
            
            {% if submission.text_content %}
            <div class="feedback-content">
                <p class="feedback-text">{{ submission.text_content[:200] }}{% if submission.text_content|length > 200 %}...{% endif %}</p>
            </div>
            {% endif %}

            {% if submission.grade %}
            <div class="feedback-scores">
                <div class="score-item">
                    <span class="score-label">Overall Score</span>
                    <span class="score-value">{{ submission.grade.score }}</span>
                </div>
                {% if submission.grade.pronunciation_score %}
                <div class="score-item">
                    <span class="score-label">Pronunciation</span>
                    <span class="score-value">{{ submission.grade.pronunciation_score }}</span>
                </div>
                {% endif %}
                {% if submission.grade.fluency_score %}
                <div class="score-item">
                    <span class="score-label">Fluency</span>
                    <span class="score-value">{{ submission.grade.fluency_score }}</span>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <div class="feedback-actions">
                <button class="btn-feedback"
                        onclick="window.location.href='{{ url_for('view_feedback', submission_id=submission.id) }}'">
                    View Full
                </button>
                <button class="btn-feedback secondary"
                        onclick="window.location.href='{{ url_for('instructor_student_detail', student_id=submission.student_id) }}'">
                    View Student
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    function applyFilter(type) {
        const params = new URLSearchParams(window.location.search);
        if (type === 'all') {
            params.delete('type');
        } else {
            params.set('type', type);
        }
        const url = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
        window.location.href = url;
    }
</script>
{% endblock %}






